{% extends "layout/base.html" %}

{% block private_js %}
<!-- 引入 ECharts 文件 -->
<script src="{{ url_for('static', filename='js/echarts.min.js') }}" type="text/javascript"></script>
{% endblock %}

{% block after_jquery %}
<script type="text/javascript">
	function loadOption(stroe_id) {
		$.post("{{ url_for('main.store_sku_top') }}",{ 'store_id':stroe_id, 'csrf_token': mixpus.csrf_token }, function(res) {
			if (res.success) {
				var sku_data = [];
				var income_data = [];
				for (var key = 0; key < res.data.length; key++) {
					sku_data.unshift(res.data[key].name);
					income_data.unshift(res.data[key].income);
				}

				option.yAxis.data = sku_data;
				option.series[0].data = income_data;
				
				store_product_sales.setOption({
					yAxis: {
						data: sku_data
					},
					series: [{
						type: 'bar',
						data: income_data
					}]
				});
			}
		},'json');
	}
	
	// 基于准备好的dom，初始化echarts实例
	var store_product_sales = echarts.init(document.getElementById('store-product-sales'));
	// 指定图表的配置项和数据
	var option = {
		color: ['#00a65a'],
		title: {
			text: '{{ _("Store Sales Top10") }}',
			subtext: ''
		},
		grid: {
			left: '3%',
			right: '4%',
			bottom: '3%',
			containLabel: true
		},
		tooltip: {
			trigger: 'axis',
        	axisPointer: {
            type: 'shadow'
        	}
		},
		legend: {
			data:['销售金额']
		},
		xAxis: {
		
		},
		yAxis: {
			data: []
		},
		series: [{
			name: '销售金额',
			type: 'bar',
			data: []
		}]
	};
	
	$(function () {
		mixpus.init_page_layout();
		
		store_product_sales.setOption(option);
		
		var store_id = $(".store-id").eq(0).attr('value');
		loadOption(store_id)
		
		$(".store-id").click(function() {
			var store_id = $(this).attr('value');
			loadOption(store_id);
		});
	});
</script>
{% endblock %}

{% block submenu %}
	{% include 'stats/_sub_menu.html' %}
{% endblock %}

{% block mainbar %}
<div class="list-page">
	<div class="page-header">
		{{ _('Stat charts') }}
		<span class="pull-right">
			<button class="btn btn-default" type="button" data-toggle="tooltip" title="" data-original-title="{{ _('Refresh') }}">
				<i class="glyphicon glyphicon-refresh"></i>
			</button>
		</span>
	</div>
	
	<div class="row">
		<div class="col-md-12">
			<h3 class="page-header">{{ _('Master Sales') }}</h3>
			<table class="table table-striped m-b-30">
				<thead>
					<tr>
						<th>
							{{ _('Sales revenue') }}
						</th>
						<th>
							{{ _('Sales year on year') }}
						</th>
						<th>
							{{ _('Profit') }}
						</th>
						<th>
							{{ _('Profit year on year') }}
						</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>
							{{ master_statistics.income or '--' }}元
						</td>
						<td>
							{{ master_statistics.income_yoy or '--' }}%
						</td>
						<td>
							{{ master_statistics.profit or '--' }}元
						</td>
						<td>
							{{ master_statistics.profit_yoy or '--' }}%
						</td>
					</tr>
				</tbody>
			</table>
			
			<h3 class="page-header">{{ _('Store Sales') }}</h3>
			<table class="table table-striped m-b-30">
				<thead>
					<tr>
						<th>{{ _('Store Name') }}</th>
						<th>{{ _('Revenue') }}</th>
						<th>{{ _('Revenue year on year') }}</th>
						<th>{{ _('Revenue ring') }}</th>
						<th>{{ _('Profit') }}</th>
						<th>{{ _('Profit year on year') }}</th>
						<th>{{ _('Profit ring') }}</th>
					</tr>
				</thead>
				<tbody>
					{% for store in store_statistics %}
					<tr class="store-id" value="{{ store.store_id }}">
						<td>{{ store.store.name }}</td>
						<td>{{store.income}}元</td>
						<td>{{store.income_yoy or '--'}}%</td>
						<td>{{store.income_mom or '--'}}%</td>
						<td>{{store.profit}}元</td>
						<td>{{store.profit_yoy or '--'}}%</td>
						<td>{{store.profit_mom or '--'}}%</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
			
			<h3 class="page-header">{{ _('Sales TOP10') }}</h3>
			<div class="well">
				<div id="store-product-sales" style="width: 100%;height:400px;"></div>
			</div>

		</div>
	</div>

</div>
{% endblock %}