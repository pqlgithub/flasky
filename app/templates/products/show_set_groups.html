{% extends pjax("layout/base.html") %}


{% block after_jquery %}
<script type="text/javascript">
	$(function () {
		mixpus.init_page_layout();

        $('a.btn-cancel-select').click(function (e) {
            e.preventDefault();
            var url = $(this).attr('href');
            var rid = $(this).data('sn'), csrf_token= $("input[name='csrf_token']").val();

            $.post(url, {'csrf_token': csrf_token, 'rid':rid }, function (result) {
                    if (result.success) {
                        $('#product-'+rid).remove();
                    } else {
                        return mixpus.show_error_message(result.status.message)
                    }
                });
        });
	});
</script>
{% endblock %}

{% block mainbar %}
<div class="list-page">
	<div class="page-header">
		{{ _('Product Group') }}
		<div class="pull-right">
			{% include 'block/_select_items.html' %}

            <a href="{{ url_for('main.show_group_products', id=product_group.id) }}" data-toggle="tooltip" class="pjax btn btn-default" data-original-title="{{ _('Refresh') }}">
				<i class="fa fa-refresh"></i>
			</a>
            <a href="{{ url_for('main.show_product_groups') }}" class="pjax btn btn-icon btn-default" data-toggle="tooltip" data-original-title="{{ _('Cancel') }}">
				<i class="fa fa-reply"></i>
			</a>
		</div>
	</div>

    <div class="well m-t-20">
        {{ _('Product Group') }}: <b>{{ product_group.name }}</b>
        <a href="{{ url_for('main.ajax_product_for_group', id=product_group.id) }}" data-modal="products-modal" class="btn btn-success m-l-30 ajax-modal">
            <i class="fa fa-search-plus"></i> Select Products
        </a>
    </div>

    <div class="table-responsive m-t-20">
        <form id="groups-form" action="" method="post">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" >

            <table class="table table-bordered table-striped table-hover">
                <thead>
                <tr>
                    <th class="text-center">
                        <input name="check_all" type="checkbox" class="check-all">
                    </th>
                    <th class="text-center">{{ _('Image') }}</th>
                    <th>{{ _('Product Info') }}</th>
                    <th>{{ _('Category') }}</th>
                    <th>{{ _('Brand') }}</th>
                    <th class="text-right">{{ _('Sale Price') }}</th>
                    <th class="text-right">{{ _('Stock') }}</th>
                    <th class="text-right">{{ _('Status') }}</th>
                    <th class="text-right">{{ _('Action') }}</th>
                </tr>
                </thead>
                <tbody>
                {% for product in selected_products.items %}
                <tr id="product-{{ product.serial_no }}">
                    <td class="text-center">
                        <input name="selected[]" class="check-one" value="{{ product.serial_no }}" type="checkbox">
                    </td>
                    <td class="text-center">
                        <img src="{{ product.cover.view_url }}" width="60px">
                    </td>
                    <td>
                        {% if product.region_id == 1 %}
                        <span class="text-mixpus">{{ product.serial_no }}</span>
                        {% else %}
                        <span class="text-warning">{{ product.serial_no }}</span>
                        {% endif %}
                        <br>
                        {{ product.name|safe }}
                    </td>
                    <td>
                        {% for c in product.categories %}
                        <span>{{ c.name }}</span>{% if not loop.last %},{% endif %}
                        {% endfor %}
                    </td>
                    <td>
                        {{ product.brand.name }}
                    </td>
                    <td class="text-right">
                        {{ product.sale_price|round(precision=2) }} {{ product.currency_unit }}
                    </td>
                    <td class="text-right">

                    </td>
                    <td class="text-right">
                        <span class="indicator {{ product.status_label[2] }}">{{ product.status_label[1] }}</span>
                    </td>
                    <td class="text-right">
                        <a href="{{ url_for('main.remove_product_from_group', id=product_group.id) }}" data-sn="{{ product.serial_no }}" class="btn btn-link btn-cancel-select">
                            {{ _('Cancel Selected') }}
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </table>
        </form>

    </div>

    {% import "block/_macros.html" as macros %}
    {{ macros.pagination_widget(selected_products, '.show_group_products', id=product_group.id) }}

</div>
{% endblock %}