<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
		{% if title %}
		<title>{{ title }} - Micku</title>
		{% else %}
		<title>Micku</title>
		{% endif %}

		<!-- Bootstrap -->
		<link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
		<!-- TODC Bootstrap theme -->
		<link href="{{ url_for('static', filename='css/todc-bootstrap.min.css') }}" rel="stylesheet">
		<link href="{{ url_for('static', filename='css/sweet-alert.css') }}" rel="stylesheet">
		<link href="{{ url_for('static', filename='css/select2.css') }}" rel="stylesheet">
		<link href="{{ url_for('static', filename='css/jquery.plupload.queue.css', _external=True) }}" rel="stylesheet">
		{% block private_styles %}{% endblock %}

		<link href="{{ url_for('static', filename='css/app.css') }}" rel="stylesheet">

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
		<script src="{{ url_for('static', filename='js/moment-with-locales.min.js', _external=True) }}" type="text/javascript"></script>
		{{ moment.lang(g.locale) }}
		<script type="text/javascript">
			var csrf_token = "{{ csrf_token() }}", img_last_open_folder = '';
		</script>
	</head>

	<body>
		{% block header %}
		<header class="navbar navbar-masthead navbar-default navbar-fixed-top">
			<div class="container-fluid">
				<div class="navbar-header">
					<button class="navbar-toggle collapsed" type="button" data-target="#bs-navbar" data-toggle="collapse" aria-expanded="false">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a href="../" class="navbar-brand">C</a>
				</div>
				<nav class="collapse navbar-collapse">
					<ul class="nav navbar-nav">
						<li>
							<a href="{{ url_for('main.index') }}">{{ _('Index') }}</a>
						</li>
						<li {% if top_menu == 'orders' %}class="active"{% endif %}>
							<a href="{{ url_for('main.show_orders') }}">{{ _('Orders') }}</a>
						</li>
						<li {% if top_menu == 'products' %}class="active"{% endif %}>
							<a href="{{ url_for('main.show_products') }}">{{ _('Products') }}</a>
						</li>
						<li {% if top_menu == 'purchases' %}class="active"{% endif %}>
							<a href="{{ url_for('main.show_purchases') }}">{{ _('Purchase') }}</a>
						</li>
						<li {% if top_menu == 'warehouses' %}class="active"{% endif %}>
							<a href="{{ url_for('main.show_stocks') }}">{{ _('Warehouse') }}</a>
						</li>
						<li>
							<a href="../customize/">{{ _('Logistics') }}</a>
						</li>
						<li>
							<a href="../customize/">{{ _('Service') }}</a>
						</li>
						<li {% if top_menu == 'finances' %}class="active"{% endif %}>
							<a href="{{ url_for('main.show_payments') }}">{{ _('Finance') }}</a>
						</li>
						<li>
							<a href="{{ url_for('main.stats') }}">{{ _('Reports') }}</a>
						</li>
						<li {% if top_menu == 'settings' %}class="active"{% endif %}>
							<a href="{{ url_for('main.show_settings') }}">{{ _('Settings') }}</a>
						</li>
					</ul>

					<ul class="nav navbar-nav navbar-right">
						<li>
							<a href="javascript:void(0);" title="{{ _('Select languages') }}" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="true">
								<span class="glyphicon glyphicon-globe"></span>
							</a>
							<ul class="dropdown-menu">
								<li {% if g.locale == 'en' %}class="active"{% endif %}>
									<a href="/en">English</a>
								</li>
								<li {% if g.locale == 'zh' %}class="active"{% endif %}>
									<a href="/zh">简体中文</a>
								</li>
							</ul>
						</li>
						<li>
							<a href="../toolbar-static-top/">
								<span class="glyphicon glyphicon-bell"></span>
							</a>
						</li>
						<li class="dropdown active">
							<a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown" role="button"  aria-haspopup="true" aria-expanded="true">
								<span class="glyphicon glyphicon-user"></span>
								{% if current_user.is_authenticated %}
									 {{ current_user.username }}
								{% endif %}
							</a>
							<ul class="dropdown-menu">
								<li><a href="#">{{ _('Profile') }}</a></li>
								<li><a href="#">{{ _('Update password') }}</a></li>
								<li role="separator" class="divider"></li>
								<li><a href="{{ url_for('auth.logout') }}">{{ _('Logout') }}</a></li>
							</ul>
						</li>
					</ul>
				</nav>
			</div>
		</header>
		{% endblock %}

		<div class="container-fluid">
			{% block content %}
			<div class="col-sm-3 col-md-2 sidebar">
				{% block sidebar %}{% endblock %}
				<div class="well">
					<p>
						<strong>{{ _('Service') }}</strong> <br/>
						Email: service@urknow.com <br/>
						Wechat: urknow
					</p>
				</div>
			</div>
			<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
				{% with messages = get_flashed_messages(with_categories=true) %}
					{% if messages %}
					<div class="flashes">
						{% for category, message in messages %}
						<div class="alert alert-{{ category }} alert-dismissable">
							<button class="close" type="button" data-dismiss="alert" aria-hidden="true">×</button>
							{% if category == 'success' %}
							<strong>Well done!</strong>
							{% endif %}

							{% if category == 'danger' %}
							<strong>Oh snap!</strong>
							{% endif %}

							{{ message }}
						</div>
						{% endfor %}
					</div>
					{% endif %}
				{% endwith %}

				{% block mainbar %}{% endblock %}
			</div>
			{% endblock %}
		</div> <!-- /container -->
		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="{{ url_for('static', filename='js/jquery.min.js') }}" type="text/javascript"></script>
		<!-- Include all compiled plugins (below), or include individual files as needed -->
		<script src="{{ url_for('static', filename='js/bootstrap.min.js') }}" type="text/javascript"></script>
		<script src="{{ url_for('static', filename='js/jquery.cookie.js', _external=True) }}" type="text/javascript"></script>
		<script src="{{ url_for('static', filename='js/sweet-alert.min.js', _external=True) }}" type="text/javascript"></script>
		<script src="{{ url_for('static', filename='js/select2.js', _external=True) }}" type="text/javascript"></script>
		<script src="{{ url_for('static', filename='js/plupload.full.min.js', _external=True) }}" type="text/javascript"></script>
		<script src="{{ url_for('static', filename='js/jquery.plupload.queue.js', _external=True) }}" type="text/javascript"></script>
		<script src="{{ url_for('static', filename='js/app.js') }}" type="text/javascript"></script>
		{% block private_js %}{% endblock %}
		<script type="text/javascript">
			$(function(){
				// Image Manager
				$(document).on('click', 'a[data-toggle=\'image\']', function(e) {
					var $element = $(this);
					var $popover = $element.data('bs.popover'); // element has bs popover?
					var $target = $(this).data('target');

					e.preventDefault();

					// destroy all image popovers
					$('a[data-toggle="image"]').popover('destroy');

					// remove flickering (do not re-add popover when clicking for removal)
					if ($popover) {
						return;
					}

					$element.popover({
						html: true,
						placement: 'right',
						trigger: 'manual',
						content: function() {
							return '<button type="button" id="button-image" class="btn btn-primary"><i class="glyphicon glyphicon-edit"></i></button> <button type="button" id="button-clear" class="btn btn-danger"><i class="glyphicon glyphicon-trash"></i></button>';
						}
					});

					$element.popover('show');

					$('#button-image').on('click', function() {
						var $button = $(this);
						var $icon   = $button.find('> i');

						$('#modal-image').remove();

						if ($.cookie('img_last_open_folder') && ($.cookie('img_last_open_folder') != 'undefined')) {
							img_last_open_folder = $.cookie('img_last_open_folder');
						}

						$.ajax({
							url: '{{ url_for("main.show_asset") }}?directory=' + img_last_open_folder + '&up_target=' + $target,
							dataType: 'html',
							beforeSend: function() {
								$button.prop('disabled', true);
								if ($icon.length) {
									$icon.attr('class', 'fa fa-circle-o-notch fa-spin');
								}
							},
							complete: function() {
								$button.prop('disabled', false);
								if ($icon.length) {
									$icon.attr('class', 'fa fa-pencil');
								}
							},
							success: function(html) {
								$('body').append('<div id="modal-image" class="modal">' + html + '</div>');

								$('#modal-image').modal('show');
							}
						});

						$element.popover('destroy');
					});

					$('#button-clear').on('click', function() {
						$element.find('img').attr('src', $element.find('img').attr('data-placeholder'));

						$element.parent().find('input').val('');

						$element.popover('destroy');
					});

				});

				{% block jquery %}
				// current document scripts
				{% endblock %}
			});
		</script>
	</body>
</html>